var WazeSpace;(()=>{"use strict";var n={d:(t,r)=>{for(var e in r)n.o(r,e)&&!n.o(t,e)&&Object.defineProperty(t,e,{enumerable:!0,get:r[e]})},o:(n,t)=>Object.prototype.hasOwnProperty.call(n,t),r:n=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"t",{value:!0})}},t={};n.d(t,{default:()=>m});var r={};function e(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];for(var r="",e=0;e<arguments.length;e++){var i=n[e];i&&(r+=r?"/"+i:i)}return function(n){var t="/"===n.charAt(0),r=n&&"/"===n[n.length-1],e=n.startsWith("http://"),i=n.startsWith("https://");return e?n=n.substring(7):i&&(n=n.substring(8)),(n=function(n,t){for(var r=[],e=0;e<n.length;e++){var i=n[e];i&&"."!==i&&(".."===i?r.length&&".."!==r[r.length-1]?r.pop():t&&r.push(".."):r.push(i))}return r}(n.split("/"),!t).join("/"))||t||(n="."),n&&r&&(n+="/"),n&&e&&(n="http://"+n),n&&i&&(n="https://"+n),(t?"/":"")+n}(r)}n.r(r),n.d(r,{join:()=>e});var i=function(n,t,r,e){return new(r||(r=Promise))((function(i,u){function o(n){try{a(e.next(n))}catch(n){u(n)}}function c(n){try{a(e.throw(n))}catch(n){u(n)}}function a(n){var t;n.done?i(n.value):(t=n.value,t instanceof r?t:new r((function(n){n(t)}))).then(o,c)}a((e=e.apply(n,t||[])).next())}))},u=function(n,t){var r,e,i,u,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return u={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(c){return function(a){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,c[0]&&(o=0)),o;)try{if(r=1,e&&(i=2&c[0]?e.return:c[0]?e.throw||((i=e.return)&&i.call(e),0):e.next)&&!(i=i.call(e,c[1])).done)return i;switch(e=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,e=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(n,o)}catch(n){c=[6,n],e=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}},o=function(n,t,r){if(r||2===arguments.length)for(var e,i=0,u=t.length;i<u;i++)!e&&i in t||(e||(e=Array.prototype.slice.call(t,0,i)),e[i]=t[i]);return n.concat(e||Array.prototype.slice.call(t))},c=function(){function n(t){var r=this;this.i=t,n.u().then((function(n){return r.h=n}))}return n.prototype.v=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];if(!n.length)return null;var i=!n[0].startsWith("http");if(i&&!this.i)throw new Error("Host is not defined");return i?e.apply(r,o([this.i],n,!1)):e.apply(r,n)},n.prototype.l=function(n){return"string"==typeof n?n:JSON.stringify(n)},n.prototype.p=function(n){return i(this,void 0,void 0,(function(){return u(this,(function(t){switch(t.label){case 0:if(!n)throw new Error("Response is null");return n.status<200||n.status>299?[4,n.json()]:[3,2];case 1:throw t.sent();case 2:return[2,n]}}))}))},n.prototype.m=function(n,t,r){var e=this;if("GM_xmlhttpRequest"in window&&"function"==typeof window.GM_xmlhttpRequest){var i=window.GM_xmlhttpRequest;return new Promise((function(u){i({method:n,url:t,data:e.l(r),onload:u})}))}throw new Error("Unavailable implementation of GM XHR")},n.prototype.k=function(n,t,r){return fetch(t,{method:n,body:this.l(r)})},n.prototype.S=function(n){if(!this.accessToken)return n;var t=new URL(n);return t.searchParams.set("token",this.accessToken),t.toString()},n.prototype.T=function(n,t,r){return i(this,void 0,void 0,(function(){var e;return u(this,(function(i){switch(i.label){case 0:t=this.v(t),t=this.S(t),e=null,i.label=1;case 1:return i.trys.push([1,3,5,7]),[4,this.m(n,t,r)];case 2:return e=i.sent(),[3,7];case 3:return i.sent(),[4,this.k(n,t,r)];case 4:return e=i.sent(),[3,7];case 5:return[4,this.p(e)];case 6:return[2,i.sent()];case 7:return[2]}}))}))},n.prototype.O=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];return new URL(this.v.apply(this,o([this.i],n,!1)))},n.u=function(){return i(this,void 0,void 0,(function(){var n;return u(this,(function(t){switch(t.label){case 0:return(n=window.GM_getValue)?[4,n("WAZE_SPACE_CLIENT_TOKEN",null)]:[2];case 1:return[2,t.sent()]}}))}))},Object.defineProperty(n.prototype,"accessToken",{get:function(){return this.h},set:function(n){this.h=n;var t=window.GM_setValue;t&&t("WAZE_SPACE_CLIENT_TOKEN",n)},enumerable:!1,configurable:!0}),n}(),a=function(n,t,r,e){return new(r||(r=Promise))((function(i,u){function o(n){try{a(e.next(n))}catch(n){u(n)}}function c(n){try{a(e.throw(n))}catch(n){u(n)}}function a(n){var t;n.done?i(n.value):(t=n.value,t instanceof r?t:new r((function(n){n(t)}))).then(o,c)}a((e=e.apply(n,t||[])).next())}))},f=function(n,t){var r,e,i,u,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return u={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(c){return function(a){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,c[0]&&(o=0)),o;)try{if(r=1,e&&(i=2&c[0]?e.return:c[0]?e.throw||((i=e.return)&&i.call(e),0):e.next)&&!(i=i.call(e,c[1])).done)return i;switch(e=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,e=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(n,o)}catch(n){c=[6,n],e=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}},s=function(n,t,r){if(r||2===arguments.length)for(var e,i=0,u=t.length;i<u;i++)!e&&i in t||(e||(e=Array.prototype.slice.call(t,0,i)),e[i]=t[i]);return n.concat(e||Array.prototype.slice.call(t))},h=function(){function n(n){this.P=n}return n.prototype.v=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return e.apply(r,s([n._],t,!1))},n.prototype.getKeys=function(){return a(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.P.T("GET",n._)];case 1:return[4,t.sent().json()];case 2:return[2,t.sent()]}}))}))},n.prototype.getItem=function(n){return a(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.P.T("GET",this.v(n))];case 1:return[4,t.sent().text()];case 2:return[2,t.sent()]}}))}))},n.prototype.setItem=function(n,t){return a(this,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,this.P.T("PUT",this.v(n),t)];case 1:return r.sent(),[2]}}))}))},n.prototype.removeItem=function(n){return a(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.P.T("DELETE",this.v(n))];case 1:return t.sent(),[2]}}))}))},n.prototype.removeAllItems=function(){return a(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.P.T("DELETE",n._)];case 1:return t.sent(),[2]}}))}))},n._="/cloud-storage/",n}();var v=function(n,t,r,e){return new(r||(r=Promise))((function(i,u){function o(n){try{a(e.next(n))}catch(n){u(n)}}function c(n){try{a(e.throw(n))}catch(n){u(n)}}function a(n){var t;n.done?i(n.value):(t=n.value,t instanceof r?t:new r((function(n){n(t)}))).then(o,c)}a((e=e.apply(n,t||[])).next())}))},w=function(n,t){var r,e,i,u,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return u={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(c){return function(a){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,c[0]&&(o=0)),o;)try{if(r=1,e&&(i=2&c[0]?e.return:c[0]?e.throw||((i=e.return)&&i.call(e),0):e.next)&&!(i=i.call(e,c[1])).done)return i;switch(e=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,e=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(n,o)}catch(n){c=[6,n],e=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}};function d(n,t){return v(this,void 0,void 0,(function(){var r;return w(this,(function(e){switch(e.label){case 0:return i="_csrf_token",u=document.cookie.split("; ").find((function(n){return n.startsWith(i+"=")})),r=u?u.split("=")[1]:null,[4,fetch(("unsafeWindow"in window?window.unsafeWindow:window).W.Config.paths.updateRequestComments,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":r},body:new URLSearchParams({mapUpdateRequestID:n.toString(),text:t})})];case 1:return[4,e.sent().json()];case 2:return[2,e.sent().comment]}var i,u}))}))}var l=function(){return l=Object.assign||function(n){for(var t,r=1,e=arguments.length;r<e;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i]);return n},l.apply(this,arguments)},y=function(n,t,r,e){return new(r||(r=Promise))((function(i,u){function o(n){try{a(e.next(n))}catch(n){u(n)}}function c(n){try{a(e.throw(n))}catch(n){u(n)}}function a(n){var t;n.done?i(n.value):(t=n.value,t instanceof r?t:new r((function(n){n(t)}))).then(o,c)}a((e=e.apply(n,t||[])).next())}))},b=function(n,t){var r,e,i,u,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return u={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(c){return function(a){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;u&&(u=0,c[0]&&(o=0)),o;)try{if(r=1,e&&(i=2&c[0]?e.return:c[0]?e.throw||((i=e.return)&&i.call(e),0):e.next)&&!(i=i.call(e,c[1])).done)return i;switch(e=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,e=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(n,o)}catch(n){c=[6,n],e=0}finally{r=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}},p={host:"https://us.waze.space"};const m=function(){function n(t){this.j=l(l({},p),t),n.G(this.j),this.P=new c(this.j.host),this.A=new h(this.P)}return n.G=function(n){if(!n.userscriptId)throw new Error("UserScript ID is required")},n.prototype.R=function(){return y(this,void 0,void 0,(function(){var n;return b(this,(function(t){switch(t.label){case 0:return(n=this.P.O("/auth/init")).searchParams.set("script",this.j.userscriptId),[4,this.P.T("GET",n.toString())];case 1:return[4,t.sent().json()];case 2:return[2,t.sent()]}}))}))},n.prototype.U=function(n,t){return y(this,void 0,void 0,(function(){var r;return b(this,(function(e){switch(e.label){case 0:return(r=this.P.O("/auth/".concat(n))).searchParams.set("cid",t.toString()),[4,this.P.T("PUT",r.toString())];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},n.prototype.authenticate=function(){return y(this,void 0,void 0,(function(){var n,t,r,e;return b(this,(function(i){switch(i.label){case 0:return[4,this.R()];case 1:return n=i.sent(),t="".concat(n.sessionKey,""),[4,d(n.target.id,t)];case 2:return r=i.sent().id,[4,this.U(n.sessionKey,r)];case 3:return e=i.sent(),this.P.accessToken=e.token,[2]}}))}))},Object.defineProperty(n.prototype,"accessToken",{get:function(){return this.P.accessToken},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"cloudStorage",{get:function(){return this.A},enumerable:!1,configurable:!0}),n.VERSION="1.0.0",n}();WazeSpace=t.default})();